# For documentation on config params, see:
# https://dev.mysql.com/doc/refman/8.0/en/mysql-cluster-ndbd-definition.html

[NDBD DEFAULT] 
AutomaticMemoryConfig=true
AutomaticThreadConfig=true

NoOfReplicas={{.Configuration.NdbdDefault.MaxReplicationFactor}}

# Setting this parameter to TRUE or 1 binds IP_ADDR_ANY so that connections can be made from anywhere (for autogenerated connections). The default is FALSE (0).
TcpBind_INADDR_ANY=FALSE

MaxNoOfConcurrentOperations=200000
MaxDMLOperationsPerTransaction=32K

MaxNoOfConcurrentScans=500

#The maximum time in ms that is permitted to lapse between operations in the same transaction before the transaction is aborted.
TransactionInactiveTimeout=1500

TransactionDeadlockDetectionTimeout=1500

#0: Disables locking. This is the default value.
#1: Performs the lock after allocating memory for the process.
#2: Performs the lock before memory for the process is allocated.
# Needs root privileges
LockPagesInMainMemory=1

# Savings of up to 50% over noncompressed LCPs and backups
CompressedLCP=0
CompressedBackup=1

BackupLogBufferSize= 16M

#The maximum size of the memory unit to use when allocating memory for tables
MaxAllocate=32M

# Needs root privileges
ODirect=0

Numa=1

# Move this to another drive if you have a high number of ops/sec
InitialLogFileGroup=name=lg_1;undo_buffer_size=128M;undo_log_0.log:4G

# Move this to another drive to store small files in HopsFS
InitialTablespace=name=ts_1;extent_size=16M;ts_1_data_file_0.dat:8G

[MYSQLD DEFAULT]

[NDB_MGMD DEFAULT]

[TCP DEFAULT]
OverloadLimit=0

#
# Supports up to Max 3 ndb_mgmds. First one gets ArbitrationRank=1, others gets lower priority ArbitrationRank=2
#
{{range .Mgmd}}
[NDB_MGMD]
NodeId={{.NodeId}}
LocationDomainId=0
HostName={{.Ip}}
PortNumber={{.Port}}
NodeActive={{.NodeActive}}
DataDir=/srv/hops/mysql-cluster/log
LogDestination=FILE:filename=/srv/hops/mysql-cluster/log/cluster.log,maxsize=10000000,maxfiles=6
ArbitrationRank={{.ArbitrationRank}}
{{end}}

#Inactive Data nodes, to enable increase of replication level
#Hostname doesn't matter since it isn't allowed to connect to
#the cluster and before this can be done the node must be
#activated and an inactive node can change its hostname.
#Inactive nodes have NodeActive set to 0.
{{range .Ndbd}}
[NDBD]
NodeId={{.NodeId}}
NodeGroup={{.NodeGroupId}}
NodeActive={{.NodeActive}}
LocationDomainId=0
HostName={{.Ip}}
ServerPort={{.Port}}
DataDir=/srv/hops/mysql-cluster/log
FileSystemPath=/srv/hops/mysql-cluster/ndb_data/{{.NodeId}}
FileSystemPathDD=/srv/hops/mysql-cluster/ndb_disk_columns
BackupDataDir=/srv/hops/mysql-cluster/ndb/backups
{{end}}

#MySQL Servers, Memcached servers, and Clusterj clients.
{{range .Mysqld}}
[MYSQLD]
NodeId={{.NodeId}}
LocationDomainId=0
HostName={{.Ip}}
{{end}}

[MYSQLD]

# List of all the services which are allowed to talk to NDB
{{range .Api}}
[API]
NodeId={{.NodeId}}
LocationDomainId=0
HostName={{.Ip}}
{{end}}

[API]
[API]
[API]

[API]
[API]
[API]
[API]
[API]
